@{
    ViewBag.Title = "專案執行-成本異動單";
    Layout = "~/Views/Shared/_MenuLayout.cshtml";
}
<!--標單項目搜尋區條件區域-->
<div class="page-header">
    <h3 style="height:20px;line-height:10px">@ViewBag.Title</h3>
    <div class="container">
        <form name="CostChangeForm" id="CostChangeForm" action="/Plan/creatOrModifyChangeForm" method="post">
            <div class="row form-group">
                <label class="col-sm-1 control-label">專案編號:</label>
                <div class="col-sm-2">
                    <input class="form-control" type="text" id="projectId" name="projectId" value="@ViewBag.projectId" readonly />
                </div>
                <label class="col-sm-1 control-label">專案名稱:</label>
                <label class="col-sm-6 info">@ViewBag.projectName</label>
                <label class="col-sm-2 alert-warning">狀態:<input type="text" id="status" name="status" value="@ViewBag.formStatus" readonly size="3" /></label>
            </div>
            <div class="row form-group">
                <label class="col-sm-1 control-label">單號:</label>
                <div class="col-sm-2">
                    <input class="form-control" type="text" id="txtFormId" name="txtFormId" value="@ViewBag.FormId" readonly />
                </div>
                <div class="col-sm-3">
                    <a class="btn btn-link" href="#">下載</a>
                    <button class="btn btn-link" data-toggle="modal" data-target="#formUploadItem" type="button">上傳</button>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-1 control-label">說明</label>
                <div class="col-sm-4">
                    <textarea class="form-control" rows="3" id="remark" name="remark">@ViewBag.Remark</textarea>
                </div>
                <div class="col-sm-2">
                    <button id="btnSave" class="btn btn-default" type="submit">儲存</button>
                    <button id="btnSent" class="btn btn-info" type="button">送審</button>
                </div>
            </div>

            <div class="row body-content">
                @if (null != Model)
            {
                Html.RenderPartial("_ChangeOrderItemList");
            }
            </div>
        </form>
    </div>
</div>

<!-- Modal :對話框 上傳檔案-->
<div class="modal fade" id="formUploadItem" role="dialog">
    <div class="modal-dialog" id="formUploadItem">
        <div class="modal-content">
            <form id="formFileUpload" name="formFileUpload" action="/Tender/uploadProjectItem" method="post" enctype="multipart/form-data">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">上傳異動明細資料</h4>
                </div>
                <div class="modal-body form-group">
                    <input id="id" name="id" type="text" value="@ViewBag.id" class="form-control" style="background-color:#cccccc;" readonly="readonly" />
                    <input type="file" name="file1" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">關閉</button>
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="上傳" onclick="uploadPlanItem()" />
                </div>
            </form>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function () {
        // Hide the "busy" Gif at load:
        $("#divProcessing").hide();
        // Attach click handler to the submit button:
        $('#btnQuery').click(function () {
            $("#divProcessing").show();
        });
    });

    function uploadPlanItem() {
        alert("Upload");
        return;
        $("#divProcessing").show();
        $("#formFileUpload").submit(function (e) {
            var formObj = $(this);
            var formURL = formObj.attr("action");
            var formData = new FormData(this);
            $.ajax({
                url: formURL,
                type: 'POST',
                data: formData,
                mimeType: "multipart/form-data",
                contentType: false,
                cache: false,
                processData: false,
                success: function (data, textStatus, jqXHR) {
                    alert(data);
                    $("#divProcessing").hide();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR);
                    $("#divProcessing").hide();
                }
            });
            e.preventDefault(); //Prevent Default action.
            e.unbind();
        });
        $("#formFileUpload").submit(); //Submit the form
    }
</script>
