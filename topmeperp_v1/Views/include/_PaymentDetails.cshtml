<div class="row">
    @{
    //**前期加總金額*@
    var t_payment_transfer = "";
    //@*外勞費用*@
    var t_foreign = "";
    //@*小計*@
    var t_sub_amount = "";
    //@*保留款*@
    var t_retention = "";
    //@*預付款*@
    var t_advance = "";
    //@*代付扣回*@
    var t_refund = "";
    //@*其他扣款*@
    var t_other = "";
    //@**應付金額*@
    var t_payable = "";
    //  @**稅金*@
    var t_tax = "";
    //前期實付金額
    var t_payamount = "";
    var cur_payment = 0.0;
    foreach (var um in Model.EstimationItems)
    {
        cur_payment = cur_payment + Convert.ToDouble(um.EstimationAmount);
    }

    //@**本期金額*@
    //@*代付支出*@
    var cur_payment_transfer = @Model.planEST.PAYMENT_TRANSFER ?? 0.0;
    //@*外勞費用*@
    var cur_foreign = @Model.planEST.FOREIGN_PAYMENT ?? 0.0;
    //@*小計*@
    var cur_sub_amount = cur_payment_transfer - cur_foreign;
    //@*保留款*@
    var cur_retention = @Model.planEST.RETENTION_PAYMENT ?? 0.0;
    //@*預付款*@
    var cur_advance = @Model.planEST.PREPAY_AMOUNT ?? 0.0;
    //@*代付扣回*@
    var cur_refund = @Model.planEST.PAYMENT_DEDUCTION ?? 0.0;
    //@*其他扣款*@
    var cur_other = @Model.planEST.OTHER_PAYMENT ?? 0.0;
    //@**應付金額*@
    var cur_payable = (@Model.planEST.OTHER_PAYMENT ?? 0.0) + cur_sub_amount - cur_retention - cur_advance - cur_refund - cur_other;
    //  @**稅金*@
    var cur_tax = @Model.planEST.TAX_AMOUNT ?? 0.0;
    //實付金額
    var cur_payamount = cur_payment + Convert.ToDouble(cur_payable + cur_tax);
    }

    @if (null != Model.planEST)
    {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>期別</th>
                    <th>+ 代付支出<a href="/Estimation/RePayment?id=@Model.planEST.EST_FORM_ID&contractid=@Model.planEST.CONTRACT_ID" target="_blank">＠</a></th>
                    <th>- 外勞扣款</th>
                    <th>= 小計</th>
                    <th>- 保留款 <input type="text" id="retention" name="retention" value="@ViewBag.retention" readonly="readonly" style="width:60px;" />%</th>
                    <th>- 預付款<a href="/Estimation/AdvancePayment?id=@Model.planEST.EST_FORM_ID&contractid=@Model.planEST.CONTRACT_ID" target="_blank">＠</a></th>
                    <th>- 代付扣回<a href="/Estimation/Refund?id=@Model.planEST.EST_FORM_ID&contractid=@Model.planEST.CONTRACT_ID" target="_blank">＠</a></th>
                    <th>- 其他扣款<a href="/Estimation/OtherPayment?id=@Model.planEST.EST_FORM_ID&contractid=@Model.planEST.CONTRACT_ID" target="_blank" id="otherPay">＠</a></th>
                    <th>= 應付金額</th>
                    <th>+ 營業稅</th>
                    <th>= 實付金額</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>前期累計</td>
                    <td><input type="text" id="cum_t_repayment" name="cum_t_repayment" value="@t_payment_transfer" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_t_foreign" name="cum_t_foreign" value="@t_foreign" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_sub_amount" name="cum_sub_amount" value="@t_sub_amount" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_t_retention" name="cum_t_retention" value="@t_retention" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_t_advance" name="cum_t_advance" value="@t_advance" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_t_refund" name="cum_t_refund" value="@t_refund" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_t_other" name="cum_t_other" value="@t_other" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_payable_amount" name="cum_payable_amount" value="@t_payable" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_tax_amount" name="cum_tax_amount" value="@t_tax" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="cum_paid_amount" name="cum_paid_amount" value="@t_payamount" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                </tr>
                <tr>
                    <td>本期金額</td>
                    <!--代付支出 -->
                    <td><input type="text" id="t_repayment" name="t_repayment" value="@String.Format("{0:N2}",cur_payment_transfer)" style="background-color:#cccccc; width:80px;" /></td>
                    <!--外勞費用(現在不用)-->
                    <td><input type="text" id="t_foreign" name="t_foreign" value="@String.Format("{0:N2}",cur_foreign)" style="background-color:#cccccc; width:80px;" /></td>
                    <!--小計-->
                    <td><input type="text" id="sub_amount" name="sub_amount" value="@String.Format("{0:N2}", cur_sub_amount)" style="background-color:#cccccc; width:80px;" /></td>
                    <!--保留款 須由合約在計算-->
                    <td><input type="text" id="t_retention" name="t_retention" value="@String.Format("{0:N2}", cur_retention)" style="background-color:#cccccc; width:80px;" /></td>
                    <!--預付款-->
                    <td><input type="text" id="t_advance" name="t_advance" value="@String.Format("{0:N2}", cur_advance)" style="background-color:#cccccc; width:80px;" /></td>
                    <!--代付扣回-->
                    <td><input type="text" id="t_refund" name="t_refund" value="@String.Format("{0:N2}", cur_refund)" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <!--其他扣款-->
                    <td><input type="text" id="t_other" name="t_other" value="@String.Format("{0:N2}", cur_other)" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <!-- 應付金額 需合計-->
                    <td><input type="text" id="payable_amount" name="payable_amount" value="@String.Format("{0:N2}", cur_payable)" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <!-- 營業稅-->
                    <td><input type="text" id="tax_amount" name="tax_amount" value="@String.Format("{0:N2}", cur_tax)" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <!--實付金額 需合計-->
                    <td><input type="text" id="paid_amount" name="paid_amount" value="@String.Format("{0:N2}", cur_payamount)" style="width:80px;" /></td>
                </tr>
                <tr>
                    <td>累計金額</td>
                    <td><input type="text" id="total_repayment" name="total_repayment" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_foreign" name="total_foreign" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_sub_amount" name="total_sub_amount" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_retention" name="total_retention" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_advance" name="total_advance" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_refund" name="total_refund" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_other" name="total_other" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_payable_amount" name="total_payable_amount" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_tax_amount" name="total_tax_amount" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                    <td><input type="text" id="total_paid_amount" name="total_paid_amount" value="" readonly="readonly" style="background-color:#cccccc; width:80px;" /></td>
                </tr>
            </tbody>
        </table>
    }
</div>
