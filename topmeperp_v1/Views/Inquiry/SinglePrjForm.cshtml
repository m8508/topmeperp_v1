@model topmeperp.Models.InquiryFormDetail
@{
    ViewBag.Title = "備標作業-詢價單/報價單 ";
    Layout = "~/Views/Shared/_MenuLayout.cshtml";
}
@using (Html.BeginForm("UpdatePrjForm", "Inquiry", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post))
{
    <div class="page-header">

        <div class="row">
            <div class="col-md-12"><h3 class="text-center">協成水電工程事業有限公司-採購詢價單</h3></div>
        </div>
        <!-- Reg-Form new { enctype = "multipart/form-data" } -->

        <div class="row">
            <div class="form-group">
                <label for="inputprojectname" class="col-md-2 control-label">專案名稱</label>
                <div class="col-md-4">
                    @Model.prj.PROJECT_NAME
                </div>
            </div>
            <div class="form-group">
                <label for="inputsuppliername" class="col-md-2 control-label">廠商名稱 </label>
                <div class="col-md-4 ">
                    @Html.DropDownList("Supplier", (IEnumerable<SelectListItem>)ViewBag.Supplier, String.Empty, new { @class = "form-control selectpicker" })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group">
                <label for="inputitem" class="col-md-2 control-label">採購項目</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputitem" value="@Model.prjForm.FORM_NAME">
                </div>
            </div>
            <div class="form-group">
                <label for="inputcontact" class="col-md-2 control-label">聯絡人</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputcontact" style="background: #CCC">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group">
                <label for="inputowner" class="col-md-2 control-label">承辦人</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputowner" value="@Model.prjForm.OWNER_NAME">
                </div>
            </div>
            <div class="form-group">
                <label for="inputemail" class="col-md-2 control-label">E-mail</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputemail" style="background: #CCC">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group">
                <label for="inputphone" class=col-md-2 control-label">聯絡電話</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputphone" value="@Model.prjForm.OWNER_TEL">
                </div>
            </div>
            <div class="form-group">
                <label for="inputdeteline" class="col-md-2 control-label">報價期限</label>
                <div class="col-md-4">
                    @if (Model.prjForm.DUEDATE != null)
                    {
                        <input type="text" class="form-control" id="inputdateline" value='@Model.prjForm.DUEDATE.Value.ToString("yyyy/MM/dd")'>
                    }
                    else
                    {
                        <input type="text" class="form-control" id="inputdateline" value="">
                    }
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group">
                <label for="inputowneremail" class="col-md-2 control-label">承辦人E-mail</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputowneremail" value="@Model.prjForm.OWNER_EMAIL">
                </div>
            </div>
            <div class="form-group">
                <label for="inputformnumber" class="col-md-2 control-label">詢價單編號</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputformnumber" value="@Model.prjForm.FORM_ID">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group">
                <label for="inputownerfax" class="col-md-2 control-label">承辦人傳真</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="inputownerfax" value="@Model.prjForm.OWNER_FAX">
                </div>
            </div>
        </div>
    </div>
    <div class="contailer">
        @{
            Html.RenderPartial("_SinglePrjForm");
        }
    </div>
    <!--div class="row">
        <div class="col-md-12">
            <input class="btn btn-info" id="Submit2" type="button" value="" />
        </div>
    </!--div>
        -->
            }
<script>
    $(document).ready(function () {
        $(function () {
            $('#inputdateline').datetimepicker({
                format: 'YYYY/MM/DD'
            });
        });
    })
</script>
<script>
    $(function () {
        $("#inputsuppliername").keyup(
                    function () {
                        $(this).doTimeout("findinputcontact",
                            1000, function () {
                                $.get(
                                    "DataSrc.ashx",
                                    { key: $(this).val() },
                                    function (res) {
                                        $("#inputcontact").val(res);
                                    });
                            });
                    });
    });

</script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#Supplier').change(function (e) {
            e.preventDefault();
            SupplierChangeEventHandler();
        });
        //將 Supplier下拉選單給置換為 Autocomplete Combobox
        $("#Supplier").combobox();
    });
    function SupplierChangeEventHandler() {
        var selectedValue = $('#Supplier option:selected').val();
        if ($.trim(selectedValue).length > 0) {
            GetSupplierInfo($.trim(selectedValue));
        }
    }
    (function ($) {
        $.widget("ui.combobox", {
            _create: function () {
                var input,
                    that = this,
                    select = this.element.hide(),
                    selected = select.children(":selected"),
                     value = selected.val() ? selected.text() : "",
                    wrapper = this.wrapper = $("<span>")
                        .addClass("ui-combobox")
                       .insertAfter(select);

                function removeIfInvalid(element) {
                    var value = $(element).val(),
                        matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(value) + "$", "i"),
                        valid = false;
                    select.children("option").each(function () {
                        if ($(this).text().match(matcher)) {
                            this.selected = valid = true;
                            return false;
                        }
                    });
                    if (!valid) {
                        // remove invalid value, as it didn't match anything
                        $(element)
                            .val("")
                            .attr("title", value + " 沒有符合的廠商，請重新輸入")
                           .tooltip("open");
                        select.val("");
                        setTimeout(function () {
                            input.tooltip("close").attr("title", "");
                        }, 2500);
                        input.data("autocomplete").term = "";
                        return false;
                    }
                }
                input = $("<input>")
                    .appendTo(wrapper)
                    .val(value)
                    .attr("title", "")
                    .addClass("ui-state-default ui-combobox-input")
                    .autocomplete({
                        delay: 0,
                        minLength: 0,
                        source: function (request, response) {
                            var matcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
                            response(select.children("option").map(function () {
                                var text = $(this).text();
                                if (this.value && (!request.term || matcher.test(text)))
                                    return {
                                        label: text.replace(
                                        new RegExp(
                                         "(?![^&;]+;)(?!<[^<>]*)(" +
                                        $.ui.autocomplete.escapeRegex(request.term) +
                                         ")(?![^<>]*>)(?![^&;]+;)", "gi"
                                          ), "<strong>$1</strong>"),
                                        value: text,
                                        option: this
                                    };
                            }));
                        },
                        select: function (event, ui) {
                            ui.item.option.selected = true;
                            that._trigger("selected", event, {
                                item: ui.item.option
                            });
                        },
                        change: function (event, ui) {
                            if (!ui.item)
                                return removeIfInvalid(this);
                        }
                    })
        .addClass("ui-widget ui-widget-content ui-corner-left");

                input.data("autocomplete")._renderItem = function (ul, item) {
                    return $("<li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + item.label + "</a>")
                    .appendTo(ul);
                };

                $("<a>")
                .attr("tabIndex", -1)
                .attr("title", "Show All Items")
                .tooltip()
                .appendTo(wrapper)
                .button({
                    icons: {
                        primary: "ui-icon-triangle-1-s"
                    },
                    text: false
                })
             .removeClass("ui-corner-all")
                .addClass("ui-corner-right ui-combobox-toggle")
                .click(function () {
                    // close if already visible
                    if (input.autocomplete("widget").is(":visible")) {
                        input.autocomplete("close");
                        removeIfInvalid(input);
                        return;
                    }
                    // work around a bug (likely same cause as #5265)
                    $(this).blur();
                    1
                    // pass empty string as value to search for, displaying all results
                    input.autocomplete("search", "");
                    input.focus();
                });

                input
                .tooltip({
                    position: {
                        of: this.button
                    },
                    tooltipClass: "ui-state-highlight"
                });
            },

            destroy: function () {
                this.wrapper.remove();
                this.element.show();
                $.Widget.prototype.destroy.call(this);
            }
        });
    })(jQuery);
</script>
